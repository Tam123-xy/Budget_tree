from flask import Flask, render_template, redirect, url_for, flash
from flask_wtf import FlaskForm
from wtforms import StringField, SubmitField
from wtforms.validators import DataRequired
import sqlite3

app = Flask(__name__)
app.config['SECRET_KEY'] = 'goal'

class GoalForm(FlaskForm):
    goal = StringField('Enter your goal', validators=[DataRequired()])
    submit = SubmitField('Save Goal')

IMAGES = [
    "../static/tree_images/tree2.png"
    "../static/tree_images/tree3.png"
    "../static/tree_images/tree4.png"
    "../static/tree_images/tree5.png"
]

def init_db():
    with sqlite3.connect('goals.db') as conn:
        cursor = conn.cursor()
        cursor.execute('CREATE TABLE IF NOT EXISTS')

def save_goal(goal):
    with sqlite3.connect('goals.db') as conn:
        cursor = conn.cursor()
        cursor.execute('INSERT INTO goals (goal, achieved) VALUES (?,?)', (goal, 0))
        conn.commit()

def update_goal_status(goal_id):
    with sqlite3.connect('goal.db') as conn:
        cursor = conn.cursor()
        new_image = IMAGES[1]
        cursor.execute('UPDATE goals SET achieved = 1, image = ? id = ?', (new_image, goal_id))
        conn.commit()

def get_goal():
    with sqlite3.connect('goals.db') as conn:
        cursor = conn.cursor()
        cursor.execute('SELECT id, goal, achieved, image')
        return cursor.fetchone()
    
@app.route('/', methods=['GET', 'POST'])
def index():
    form = GoalForm()
    goal_data = get_goal()

    if form.validate_on_submit():
        goal = form.goal.data
        save_goal(goal)
        flash('Goal saved successfully!', 'success')
        return redirect(url_for('index'))
    
    return render_template('tree.html', goal=goal_data)

if __name__ == '__main__':
    init_db()
    app.run(debug=True)